/**
 * 브라우저 호환성 개선 CSS
 * 모든 주요 브라우저(Chrome, Firefox, Safari, Edge, IE11+)에서 작동하도록 지원
 */

/* ========================================
   CSS 변수 폴백 (IE11 지원)
   ======================================== */

/* 다크 모드 폴백 */
body {
    /* IE11 폴백 */
    background: #121212;
    color: #e0e0e0;
    
    /* 모던 브라우저 */
    background: var(--bg-primary, #121212);
    color: var(--text-primary, #e0e0e0);
}

.btn {
    background: #6366f1;
    color: white;
    background: var(--accent-primary, #6366f1);
}

.btn:hover {
    background: #4f46e5;
    background: var(--accent-hover, #4f46e5);
}

/* 라이트 모드 폴백 */
body.light-mode {
    background: #f5f5f5;
    color: #1f2937;
    background: var(--bg-primary, #f5f5f5);
    color: var(--text-primary, #1f2937);
}

/* ========================================
   Flexbox 폴백 (구형 브라우저)
   ======================================== */

/* Flexbox 접두사 추가 */
.header {
    display: -webkit-box;
    display: -webkit-flex;
    display: -ms-flexbox;
    display: flex;
    
    -webkit-box-pack: justify;
    -webkit-justify-content: space-between;
    -ms-flex-pack: justify;
    justify-content: space-between;
    
    -webkit-box-align: center;
    -webkit-align-items: center;
    -ms-flex-align: center;
    align-items: center;
}

.dashboard-container,
.settings-grid-main,
.sections-grid {
    display: -ms-grid;
    display: grid;
}

/* IE11 Grid 폴백 */
@supports not (display: grid) {
    .sections-grid {
        display: -webkit-box;
        display: -webkit-flex;
        display: -ms-flexbox;
        display: flex;
        -webkit-flex-wrap: wrap;
        -ms-flex-wrap: wrap;
        flex-wrap: wrap;
    }
    
    .section-card {
        width: calc(50% - 12px);
        margin-right: 24px;
    }
    
    .section-card:nth-child(2n) {
        margin-right: 0;
    }
}

/* ========================================
   CSS Transform 접두사
   ======================================== */

.stat-card-compact:hover,
.action-card-compact:hover {
    -webkit-transform: translateY(-2px);
    -ms-transform: translateY(-2px);
    transform: translateY(-2px);
}

.spinner {
    -webkit-animation: spin 0.8s linear infinite;
    animation: spin 0.8s linear infinite;
}

@-webkit-keyframes spin {
    to { -webkit-transform: rotate(360deg); }
}

@keyframes spin {
    to { 
        -webkit-transform: rotate(360deg);
        transform: rotate(360deg); 
    }
}

/* ========================================
   CSS Transition 접두사
   ======================================== */

.btn,
.input,
.section-more,
.notice-item,
.archive-item,
.history-item {
    -webkit-transition: all 0.2s;
    -o-transition: all 0.2s;
    transition: all 0.2s;
}

/* ========================================
   User-select 접두사
   ======================================== */

.sidebar-floating-toggle,
.btn,
button {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

/* ========================================
   Box-shadow 접두사 (Safari 구버전)
   ======================================== */

.stat-card-compact:hover,
.action-card-compact:hover,
.sidebar-floating-toggle {
    -webkit-box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
    box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
}

/* ========================================
   Border-radius 접두사 (Safari 구버전)
   ======================================== */

.btn,
.input,
.section-card,
.stat-card-compact,
.action-card-compact {
    -webkit-border-radius: 8px;
    -moz-border-radius: 8px;
    border-radius: 8px;
}

.sidebar-floating-toggle {
    -webkit-border-radius: 50%;
    -moz-border-radius: 50%;
    border-radius: 50%;
}

/* ========================================
   Appearance 제거 (크로스 브라우저)
   ======================================== */

input,
select,
textarea,
button {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
}

/* ========================================
   Scrollbar 스타일 (Firefox 포함)
   ======================================== */

/* Firefox */
* {
    scrollbar-width: thin;
    scrollbar-color: #3d3d3d #121212;
}

body.light-mode * {
    scrollbar-color: #d1d5db #f5f5f5;
}

/* Webkit 브라우저 (Chrome, Safari, Edge) */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: #121212;
    background: var(--bg-primary, #121212);
}

::-webkit-scrollbar-thumb {
    background: #3d3d3d;
    background: var(--border-color, #3d3d3d);
    -webkit-border-radius: 4px;
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: #888;
    background: var(--text-tertiary, #888);
}

/* ========================================
   Safari 특정 수정사항
   ======================================== */

/* Safari의 textarea 리사이즈 핸들 숨기기 */
textarea {
    resize: none;
}

/* Safari의 input 기본 스타일 제거 */
input[type="text"],
input[type="password"],
input[type="email"],
input[type="number"],
input[type="search"] {
    -webkit-appearance: none;
    -webkit-border-radius: 0;
    border-radius: 0;
}

/* ========================================
   Firefox 특정 수정사항
   ======================================== */

/* Firefox의 점선 outline 제거 */
button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/* Firefox의 select 화살표 커스터마이징 */
@-moz-document url-prefix() {
    select {
        padding-right: 20px;
    }
}

/* ========================================
   IE11 특정 수정사항
   ======================================== */

/* IE11의 clear 버튼 숨기기 */
input::-ms-clear {
    display: none;
}

/* IE11의 reveal 버튼 숨기기 */
input::-ms-reveal {
    display: none;
}

/* IE11의 select 화살표 숨기기 */
select::-ms-expand {
    display: none;
}

/* ========================================
   Edge 특정 수정사항
   ======================================== */

/* Edge의 input number 스핀 버튼 숨기기 */
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

/* ========================================
   Placeholder 스타일 (모든 브라우저)
   ======================================== */

::-webkit-input-placeholder { /* Chrome/Opera/Safari */
    color: #888;
    opacity: 1;
}
::-moz-placeholder { /* Firefox 19+ */
    color: #888;
    opacity: 1;
}
:-ms-input-placeholder { /* IE 10+ */
    color: #888;
    opacity: 1;
}
:-moz-placeholder { /* Firefox 18- */
    color: #888;
    opacity: 1;
}

/* ========================================
   Object-fit 폴백 (IE11)
   ======================================== */

@supports not (object-fit: cover) {
    .image-container {
        overflow: hidden;
    }
    
    .image-container img {
        width: 100%;
        height: auto;
    }
}

/* ========================================
   CSS Grid 폴백 (IE11)
   ======================================== */

/* IE11에서 Grid를 Flexbox로 대체 */
@media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {
    .settings-grid-main {
        display: -ms-flexbox;
        display: flex;
        -ms-flex-wrap: wrap;
        flex-wrap: wrap;
    }
    
    .settings-column {
        -ms-flex: 0 0 calc(33.333% - 16px);
        flex: 0 0 calc(33.333% - 16px);
        margin-right: 24px;
    }
    
    .settings-column:nth-child(3n) {
        margin-right: 0;
    }
}

/* ========================================
   Backdrop-filter 폴백 (Firefox, IE11)
   ======================================== */

@supports not (backdrop-filter: blur(10px)) {
    .modal-backdrop,
    .sidebar-floating-toggle {
        background: rgba(0, 0, 0, 0.8);
    }
}

/* ========================================
   Gap 속성 폴백 (구형 브라우저)
   ======================================== */

@supports not (gap: 24px) {
    .quick-actions-unified > * {
        margin-right: 20px;
        margin-bottom: 20px;
    }
    
    .quick-actions-unified > *:nth-child(6n) {
        margin-right: 0;
    }
    
    .sections-grid > * {
        margin-right: 24px;
        margin-bottom: 24px;
    }
    
    .sections-grid > *:nth-child(2n) {
        margin-right: 0;
    }
}

/* ========================================
   Display: contents 폴백 (IE11)
   ======================================== */

@supports not (display: contents) {
    [style*="display: contents"] {
        display: block;
    }
}

/* ========================================
   CSS 사용자 정의 속성 폴백
   ======================================== */

/* IE11을 위한 추가 폴백 색상 */
@media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {
    body {
        background: #121212;
        color: #e0e0e0;
    }
    
    body.light-mode {
        background: #f5f5f5;
        color: #1f2937;
    }
    
    .btn {
        background: #6366f1;
        color: white;
    }
    
    .btn:hover {
        background: #4f46e5;
    }
    
    .input {
        background: #1e1e1e;
        border-color: #3d3d3d;
        color: #e0e0e0;
    }
    
    .input:focus {
        border-color: #6366f1;
    }
}

/* ========================================
   Feature Queries (Progressive Enhancement)
   ======================================== */

/* Grid를 지원하는 브라우저만 사용 */
@supports (display: grid) {
    .settings-grid-main {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 24px;
    }
    
    .sections-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 24px;
    }
}

/* Flexbox를 지원하는 브라우저만 사용 */
@supports (display: flex) {
    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
}

/* ========================================
   Print 스타일 (인쇄 호환성)
   ======================================== */

@media print {
    body {
        background: white;
        color: black;
    }
    
    .header,
    .sidebar-floating-toggle,
    .btn,
    .input-actions-compact {
        display: none !important;
    }
    
    .output-content {
        border: 1px solid #ccc;
        padding: 20px;
    }
}
